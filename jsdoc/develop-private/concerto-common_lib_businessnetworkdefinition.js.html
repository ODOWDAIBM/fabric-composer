<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Concerto Source: concerto-common/lib/businessnetworkdefinition.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.spacelab.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top navbar-inverse">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">Concerto</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-ibm-concerto-admin.html">ibm-concerto-admin</a></li><li><a href="module-ibm-concerto-client.html">ibm-concerto-client</a></li><li><a href="module-ibm-concerto-common.html">ibm-concerto-common</a></li><li><a href="module-ibm-concerto-runtime.html">ibm-concerto-runtime</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="AssetRegistry.html">AssetRegistry</a></li><li><a href="Factory.html">Factory</a></li><li><a href="FileWallet.html">FileWallet</a></li><li><a href="IdentityManager.html">IdentityManager</a></li><li><a href="JSTransactionExecutor.html">JSTransactionExecutor</a></li><li><a href="module-concerto-admin.AdminConnection.html">concerto-admin.AdminConnection</a></li><li><a href="module-concerto-client.AssetRegistry.html">concerto-client.AssetRegistry</a></li><li><a href="module-concerto-client.BusinessNetworkConnection.html">concerto-client.BusinessNetworkConnection</a></li><li><a href="module-concerto-client.ParticipantRegistry.html">concerto-client.ParticipantRegistry</a></li><li><a href="module-concerto-client.Registry.html">concerto-client.Registry</a></li><li><a href="module-concerto-client.TransactionRegistry.html">concerto-client.TransactionRegistry</a></li><li><a href="module-concerto-common.AclFile.html">concerto-common.AclFile</a></li><li><a href="module-concerto-common.AclManager.html">concerto-common.AclManager</a></li><li><a href="module-concerto-common.AclRule.html">concerto-common.AclRule</a></li><li><a href="module-concerto-common.APISignatureGenerator.html">concerto-common.APISignatureGenerator</a></li><li><a href="module-concerto-common.AssetDeclaration.html">concerto-common.AssetDeclaration</a></li><li><a href="module-concerto-common.BaseException.html">concerto-common.BaseException</a></li><li><a href="module-concerto-common.BusinessNetworkDefinition.html">concerto-common.BusinessNetworkDefinition</a></li><li><a href="module-concerto-common.ClassDeclaration.html">concerto-common.ClassDeclaration</a></li><li><a href="module-concerto-common.Connection.html">concerto-common.Connection</a></li><li><a href="module-concerto-common.ConnectionManager.html">concerto-common.ConnectionManager</a></li><li><a href="module-concerto-common.ConnectionProfileManager.html">concerto-common.ConnectionProfileManager</a></li><li><a href="module-concerto-common.ConnectionProfileStore.html">concerto-common.ConnectionProfileStore</a></li><li><a href="module-concerto-common.EnumDeclaration.html">concerto-common.EnumDeclaration</a></li><li><a href="module-concerto-common.EnumValueDeclaration.html">concerto-common.EnumValueDeclaration</a></li><li><a href="module-concerto-common.Factory.html">concerto-common.Factory</a></li><li><a href="module-concerto-common.Field.html">concerto-common.Field</a></li><li><a href="module-concerto-common.FileWriter.html">concerto-common.FileWriter</a></li><li><a href="module-concerto-common.FSConnectionProfileStore.html">concerto-common.FSConnectionProfileStore</a></li><li><a href="module-concerto-common.FunctionDeclaration.html">concerto-common.FunctionDeclaration</a></li><li><a href="module-concerto-common.GoLangVisitor.html">concerto-common.GoLangVisitor</a></li><li><a href="module-concerto-common.Identifiable.html">concerto-common.Identifiable</a></li><li><a href="module-concerto-common.IllegalModelException.html">concerto-common.IllegalModelException</a></li><li><a href="module-concerto-common.InstanceGenerator.html">concerto-common.InstanceGenerator</a></li><li><a href="module-concerto-common.Introspector.html">concerto-common.Introspector</a></li><li><a href="module-concerto-common.JavaScriptParser.html">concerto-common.JavaScriptParser</a></li><li><a href="module-concerto-common.JSONGenerator.html">concerto-common.JSONGenerator</a></li><li><a href="module-concerto-common.JSONPopulator.html">concerto-common.JSONPopulator</a></li><li><a href="module-concerto-common.JSONSchemaVisitor.html">concerto-common.JSONSchemaVisitor</a></li><li><a href="module-concerto-common.JSONWriter.html">concerto-common.JSONWriter</a></li><li><a href="module-concerto-common.Logger.html">concerto-common.Logger</a></li><li><a href="module-concerto-common.LoopbackVisitor.html">concerto-common.LoopbackVisitor</a></li><li><a href="module-concerto-common.MemoryConnectionProfileStore.html">concerto-common.MemoryConnectionProfileStore</a></li><li><a href="module-concerto-common.ModelBinding.html">concerto-common.ModelBinding</a></li><li><a href="module-concerto-common.ModelFile.html">concerto-common.ModelFile</a></li><li><a href="module-concerto-common.ModelManager.html">concerto-common.ModelManager</a></li><li><a href="module-concerto-common.ModelUtil.html">concerto-common.ModelUtil</a></li><li><a href="module-concerto-common.Node.html">concerto-common.Node</a></li><li><a href="module-concerto-common.NumberValidator.html">concerto-common.NumberValidator</a></li><li><a href="module-concerto-common.ParseException.html">concerto-common.ParseException</a></li><li><a href="module-concerto-common.ParticipantDeclaration.html">concerto-common.ParticipantDeclaration</a></li><li><a href="module-concerto-common.PlantUMLGenerator.html">concerto-common.PlantUMLGenerator</a></li><li><a href="module-concerto-common.PlantUMLVisitor.html">concerto-common.PlantUMLVisitor</a></li><li><a href="module-concerto-common.Predicate.html">concerto-common.Predicate</a></li><li><a href="module-concerto-common.Property.html">concerto-common.Property</a></li><li><a href="module-concerto-common.Relationship.html">concerto-common.Relationship</a></li><li><a href="module-concerto-common.RelationshipDeclaration.html">concerto-common.RelationshipDeclaration</a></li><li><a href="module-concerto-common.Resource.html">concerto-common.Resource</a></li><li><a href="module-concerto-common.ResourceValidator.html">concerto-common.ResourceValidator</a></li><li><a href="module-concerto-common.Script.html">concerto-common.Script</a></li><li><a href="module-concerto-common.ScriptManager.html">concerto-common.ScriptManager</a></li><li><a href="module-concerto-common.SecurityContext.html">concerto-common.SecurityContext</a></li><li><a href="module-concerto-common.SecurityException.html">concerto-common.SecurityException</a></li><li><a href="module-concerto-common.Serializer.html">concerto-common.Serializer</a></li><li><a href="module-concerto-common.StringValidator.html">concerto-common.StringValidator</a></li><li><a href="module-concerto-common.TransactionDeclaration.html">concerto-common.TransactionDeclaration</a></li><li><a href="module-concerto-common.TypedStack.html">concerto-common.TypedStack</a></li><li><a href="module-concerto-common.TypescriptVisitor.html">concerto-common.TypescriptVisitor</a></li><li><a href="module-concerto-common.Util.html">concerto-common.Util</a></li><li><a href="module-concerto-common.ValidatedResource.html">concerto-common.ValidatedResource</a></li><li><a href="module-concerto-common.ValidationException.html">concerto-common.ValidationException</a></li><li><a href="module-concerto-common.Validator.html">concerto-common.Validator</a></li><li><a href="module-concerto-common.VersionChecker.html">concerto-common.VersionChecker</a></li><li><a href="module-concerto-common.Writer.html">concerto-common.Writer</a></li><li><a href="module-concerto-runtime.AccessController.html">concerto-runtime.AccessController</a></li><li><a href="module-concerto-runtime.AccessException.html">concerto-runtime.AccessException</a></li><li><a href="module-concerto-runtime.Api.html">concerto-runtime.Api</a></li><li><a href="module-concerto-runtime.AssetRegistry.html">concerto-runtime.AssetRegistry</a></li><li><a href="module-concerto-runtime.Container.html">concerto-runtime.Container</a></li><li><a href="module-concerto-runtime.Context.html">concerto-runtime.Context</a></li><li><a href="module-concerto-runtime.DataCollection.html">concerto-runtime.DataCollection</a></li><li><a href="module-concerto-runtime.DataService.html">concerto-runtime.DataService</a></li><li><a href="module-concerto-runtime.Engine.html">concerto-runtime.Engine</a></li><li><a href="module-concerto-runtime.EngineBusinessNetworks.html">concerto-runtime.EngineBusinessNetworks</a></li><li><a href="module-concerto-runtime.EngineIdentities.html">concerto-runtime.EngineIdentities</a></li><li><a href="module-concerto-runtime.EngineRegistries.html">concerto-runtime.EngineRegistries</a></li><li><a href="module-concerto-runtime.EngineResources.html">concerto-runtime.EngineResources</a></li><li><a href="module-concerto-runtime.EngineTransactions.html">concerto-runtime.EngineTransactions</a></li><li><a href="module-concerto-runtime.Factory.html">concerto-runtime.Factory</a></li><li><a href="module-concerto-runtime.IdentityService.html">concerto-runtime.IdentityService</a></li><li><a href="module-concerto-runtime.LoggingService.html">concerto-runtime.LoggingService</a></li><li><a href="module-concerto-runtime.ParticipantRegistry.html">concerto-runtime.ParticipantRegistry</a></li><li><a href="module-concerto-runtime.Resolver.html">concerto-runtime.Resolver</a></li><li><a href="module-concerto-runtime.TransactionLogger.html">concerto-runtime.TransactionLogger</a></li><li><a href="ParticipantRegistry.html">ParticipantRegistry</a></li><li><a href="QueryExecutor.html">QueryExecutor</a></li><li><a href="Registry.html">Registry</a></li><li><a href="RegistryManager.html">RegistryManager</a></li><li><a href="TransactionExecutor.html">TransactionExecutor</a></li><li><a href="Wallet.html">Wallet</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="events.list.html" class="dropdown-toggle" data-toggle="dropdown">Events<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-concerto-client.AssetRegistry.html#event:resourceadded">concerto-client.AssetRegistry#event:resourceadded</a></li><li><a href="module-concerto-client.AssetRegistry.html#event:resourceremoved">concerto-client.AssetRegistry#event:resourceremoved</a></li><li><a href="module-concerto-client.AssetRegistry.html#event:resourceupdated">concerto-client.AssetRegistry#event:resourceupdated</a></li><li><a href="module-concerto-client.ParticipantRegistry.html#event:resourceadded">concerto-client.ParticipantRegistry#event:resourceadded</a></li><li><a href="module-concerto-client.ParticipantRegistry.html#event:resourceremoved">concerto-client.ParticipantRegistry#event:resourceremoved</a></li><li><a href="module-concerto-client.ParticipantRegistry.html#event:resourceupdated">concerto-client.ParticipantRegistry#event:resourceupdated</a></li><li><a href="module-concerto-client.TransactionRegistry.html#event:resourceadded">concerto-client.TransactionRegistry#event:resourceadded</a></li><li><a href="module-concerto-client.TransactionRegistry.html#event:resourceremoved">concerto-client.TransactionRegistry#event:resourceremoved</a></li><li><a href="module-concerto-client.TransactionRegistry.html#event:resourceupdated">concerto-client.TransactionRegistry#event:resourceupdated</a></li><li><a href="Registry.html#event:resourceadded">Registry#event:resourceadded</a></li><li><a href="Registry.html#event:resourceremoved">Registry#event:resourceremoved</a></li><li><a href="Registry.html#event:resourceupdated">Registry#event:resourceupdated</a></li><li><a href="RegistryManager.html#event:registryadded">RegistryManager#event:registryadded</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="global.html#findCommentBefore">findCommentBefore</a></li><li><a href="global.html#formatMessage">formatMessage</a></li><li><a href="global.html#getDecorators">getDecorators</a></li><li><a href="global.html#getExample">getExample</a></li><li><a href="global.html#getLogger">getLogger</a></li><li><a href="global.html#getMethodArguments">getMethodArguments</a></li><li><a href="global.html#getReturnType">getReturnType</a></li><li><a href="global.html#getText">getText</a></li><li><a href="global.html#getThrows">getThrows</a></li><li><a href="global.html#getVisibility">getVisibility</a></li><li><a href="global.html#Globalize">Globalize</a></li><li><a href="global.html#messageFormatter">messageFormatter</a></li><li><a href="global.html#mixin">mixin</a></li><li><a href="global.html#paramsToString">paramsToString</a></li><li><a href="global.html#processDirectory">processDirectory</a></li><li><a href="global.html#processFile">processFile</a></li><li><a href="global.html#theWallet">theWallet</a></li><li><a href="global.html#toUMLFilename">toUMLFilename</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			

		<h1 class="page-title">Source: concerto-common/lib/businessnetworkdefinition.js</h1>
    
<section>
    <article>
        <pre
            class="sunlight-highlight-javascript linenums">/*
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

'use strict';

const Logger = require('./log/logger');
const ModelManager = require('./modelmanager');
const Introspector = require('./introspect/introspector');
const AclManager = require('./aclmanager');
const AclFile = require('./acl/aclfile');
const Factory = require('./factory');
const Serializer = require('./serializer');
const ScriptManager = require('./scriptmanager');
const JSZip = require('jszip');
const semver = require('semver');
const fs = require('fs');
const fsPath = require('path');
const minimatch = require('minimatch');

const ENCODING = 'utf8';
const LOG = Logger.getLog('BusinessNetworkDefinition');

/**
 * &lt;p>
 * A BusinessNetworkDefinition defines a set of Participants that exchange Assets by
 * sending Transactions. This class manages the metadata and domain-specific types for
 * the network as well as a set of executable scripts.
 * &lt;/p>
 * @class
 * @memberof module:concerto-common
 */
class BusinessNetworkDefinition {

    /**
     * Create the BusinessNetworkDefinition.
     * &lt;p>
     * &lt;strong>Note: Only to be called by framework code. Applications should
     * retrieve instances from {@link BusinessNetworkDefinition.fromArchive}&lt;/strong>
     * &lt;/p>
     * @param {String} identifier  - the identifier of the business network. The
     * identifier is formed from a business network name + '@' + version. The
     * version is a semver valid version string.
     * @param {String} description  - the description of the business network
     */
    constructor(identifier, description) {
        const method = 'constructor';
        LOG.entry(method, identifier, description);
        this.identifier = identifier;

        const atIndex = this.identifier.lastIndexOf('@');

        if (atIndex >= 0) {
            this.name = this.identifier.substring(0, atIndex);
        } else {
            throw new Error('Malformed business network identifier. It must be "name@major.minor.micro"');
        }

        this.version = this.identifier.substring(atIndex + 1);
        if (!semver.valid(this.version)) {
            throw new Error('Version number is invalid. Should be valid according to semver but found: ' + this.version);
        }

        this.description = description;
        this.modelManager = new ModelManager();
        this.aclManager = new AclManager(this.modelManager);
        this.scriptManager = new ScriptManager(this.modelManager);
        this.introspector = new Introspector(this.modelManager);
        this.factory = new Factory(this.modelManager);
        this.serializer = new Serializer(this.factory, this.modelManager);
        LOG.exit(method);
    }

    /**
     * Returns the identifier for this business network
     * @return {String} the identifier of this business network
     */
    getIdentifier() {
        return this.identifier;
    }

    /**
     * Returns the name for this business network
     * @return {String} the name of this business network
     */
    getName() {
        return this.name;
    }

    /**
     * Returns the version for this business network
     * @return {String} the version of this business network. Use semver module
     * to parse.
     */
    getVersion() {
        return this.version;
    }


    /**
     * Returns the description for this business network
     * @return {String} the description of this business network
     */
    getDescription() {
        return this.description;
    }

    /**
     * Create a BusinessNetworkDefinition from an archive.
     * @param {Buffer} Buffer  - the Buffer to a zip archive
     * @return {Promise} a Promise to the instantiated business network
     */
    static fromArchive(Buffer) {
        const method = 'fromArchive';
        LOG.entry(method, Buffer.length);
        return JSZip.loadAsync(Buffer).then(function(zip) {
            const allPromises = [];
            let ctoModelFiles = [];
            let jsScriptFiles = [];
            let permissionsFiles = [];
            let businessNetworkDefinition;

            LOG.debug(method, 'Loading package.json');
            let packageJson = zip.file('package.json');
            if (packageJson === null) {
                throw Error('package.json must exist');
            }
            const packagePromise = packageJson.async('string');
            allPromises.push(packagePromise);
            packagePromise.then(contents => {
                LOG.debug(method, 'Loaded package.json');
                let jsonObject = JSON.parse(contents);
                let packageName = jsonObject.name;
                let packageVersion = jsonObject.version;
                let packageDescription = jsonObject.description;
                businessNetworkDefinition = new BusinessNetworkDefinition(packageName + '@' + packageVersion, packageDescription);
            });

            LOG.debug(method, 'Looking for model files');
            let ctoFiles = zip.file(/models\/.*\.cto$/); //Matches any file which is in the 'models' folder and has a .cto extension
            ctoFiles.forEach(function(file) {
                LOG.debug(method, 'Found model file, loading it', file.name);
                const ctoPromise = file.async('string');
                allPromises.push(ctoPromise);
                ctoPromise.then(contents => {
                    LOG.debug(method, 'Loaded model file');
                    ctoModelFiles.push(contents);
                });
            });

            LOG.debug(method, 'Looking for JavaScript files');
            let jsFiles = zip.file(/lib\/.*\.js$/); //Matches any file which is in the 'lib' folder and has a .js extension
            jsFiles.forEach(function(file) {
                LOG.debug(method, 'Found JavaScript file, loading it', file.name);
                const jsPromise = file.async('string');
                allPromises.push(jsPromise);
                jsPromise.then(contents => {
                    LOG.debug(method, 'Loaded JavaScript file');
                    let tempObj = {
                        'name': file.name,
                        'contents': contents
                    };
                    jsScriptFiles.push(tempObj);

                });
            });

            LOG.debug(method, 'Loading permissions.acl');
            let aclFile = zip.file('permissions.acl');
            if (aclFile !== null) {
                const aclPromise = aclFile.async('string');
                allPromises.push(aclPromise);
                aclPromise.then(contents => {
                    LOG.debug(method, 'Loaded permissions.acl');
                    permissionsFiles.push(contents);
                });
            }

            return Promise.all(allPromises)
                .then(() => {
                    LOG.debug(method, 'Loaded all model, JavaScript, and ACL files');
                    LOG.debug(method, 'Adding model files to model manager');
                    businessNetworkDefinition.modelManager.addModelFiles(ctoModelFiles); // Adds all cto files to model manager
                    LOG.debug(method, 'Added model files to model manager');
                    // console.log('What are the jsObjectsArray?',jsObjectArray);
                    LOG.debug(method, 'Adding JavaScript files to script manager');
                    jsScriptFiles.forEach(function(obj) {
                        let jsObject = businessNetworkDefinition.scriptManager.createScript(obj.name, 'js', obj.contents);
                        businessNetworkDefinition.scriptManager.addScript(jsObject); // Adds all js files to script manager
                    });
                    LOG.debug(method, 'Added JavaScript files to script manager');
                    LOG.debug(method, 'Adding ACL files to ACL manager');
                    permissionsFiles.forEach((permissionFile) => {
                        businessNetworkDefinition.getAclManager().setAclFile( new AclFile('permissions.acl', businessNetworkDefinition.getModelManager(), permissionFile));
                    });
                    LOG.debug(method, 'Added ACL files to ACL manager');

                    LOG.exit(method, businessNetworkDefinition.toString());
                    return businessNetworkDefinition; // Returns business network (with model manager and script manager)
                });
        });
    }

    /**
     * Store a BusinessNetworkDefinition as an archive.
     * @return {Buffer} buffer  - the zlib buffer
     */
    toArchive() {

        let zip = new JSZip();

        let packageFileContents = JSON.stringify({
            name: this.name,
            version: this.version,
            description: this.description
        });

        zip.file('package.json', packageFileContents);

        const aclFile = this.getAclManager().getAclFile();
        if(aclFile) {
            zip.file(aclFile.getIdentifier(), aclFile.definitions);
        }

        let modelManager = this.getModelManager();
        let modelFiles = modelManager.getModelFiles();
        modelFiles.forEach(function(file) {
            zip.folder('models').file(file.namespace + '.cto', file.definitions);
        });

        let scriptManager = this.getScriptManager();
        let scriptFiles = scriptManager.getScripts();
        scriptFiles.forEach(function(file) {
            let fileIdentifier = file.identifier;
            let fileName = fileIdentifier.substring(fileIdentifier.lastIndexOf('/') + 1);
            zip.folder('lib').file(fileName, file.contents);
        });

        return zip.generateAsync({
            type: 'nodebuffer'
        }).then(something => {
            return Promise.resolve(something).then(result => {
                return result;
            });

        });

    }

    /**
     * Builds a BusinessNetworkDefintion from the contents of a directory.
     * The directory must include a package.json in the root (used to specify
     * the name, version and description of the business network). This method
     * is designed to work with business networks that refer to external models
     * using npm dependencies as well as business networks that statically
     * package their model files.
     * &lt;p>
     * If package.json contains a dependencies property then this method will search for
     * model (CTO) files under the node_modules directory for each dependency that
     * passes the options.dependencyGlob pattern.
     * &lt;/p>
     * &lt;p>
     * In addition all model files will be added that are not under node_modules
     * and that pass the options.modelFileGlob pattern. By default you should put
     * model files under a directory called 'models'.
     * &lt;/p>
     * &lt;p>
     * All script (js) files will be added that are not under node_modules and
     * that pass the options.scriptGlob pattern. By default you should put Javascript
     * files under the 'lib' directory.
     * &lt;/p>
     *
     * @param {String} path to a local directory
     * @param {Object} [options] - an optional set of options to configure the instance.
     * @param {Object} [options.dependencyGlob] - specify the glob pattern used to match
     * the npm dependencies to process. Defaults to **
     * @param {boolean} [options.modelFileGlob] - specify the glob pattern used to match
     * the model files to include. Defaults to **\/models/**\/*.cto
     * @param {boolean} [options.scriptGlob] - specify the glob pattern used to match
     * the script files to include. Defaults to **\/lib/**\/*.js
     * @return {Promise} a Promise to the instantiated business network
     */
    static fromDirectory(path, options) {

        if(!options) {
            options = {};
        }

        if(!options.dependencyGlob) {
            options.dependencyGlob = '**';
        }

        if(!options.modelFileGlob) {
            options.modelFileGlob = '**/models/**/*.cto';
        }

        if(!options.scriptGlob) {
            options.scriptGlob = '**/lib/**/*.js';
        }

        const method = 'fromDirectory';
        LOG.entry(method, path);

        // grab the package.json
        let packageJsonContents = fs.readFileSync( fsPath.resolve(path, 'package.json'), ENCODING);

        if(!packageJsonContents) {
            throw new Error('Failed to find package.json');
        }

        LOG.debug(method, 'Loaded package.json', packageJsonContents);

        // parse the package.json
        let jsonObject = JSON.parse(packageJsonContents);
        let packageName = jsonObject.name;
        let packageVersion = jsonObject.version;
        let packageDescription = jsonObject.description;

        // create the business network definition
        const businessNetwork = new BusinessNetworkDefinition(packageName + '@' + packageVersion, packageDescription);
        const modelFiles = [];

        // process each module dependency
        // filtering using a glob on the module dependency name
        if(jsonObject.dependencies) {
            LOG.debug(method, 'All dependencies', Object.keys(jsonObject.dependencies).toString());
            const dependencies = Object.keys(jsonObject.dependencies).filter(minimatch.filter(options.dependencyGlob));
            LOG.debug(method, 'Matched dependencies', dependencies);

            for( let dep of dependencies) {
                // find all the *.cto files under the npm install dependency path
                let dependencyPath = fsPath.resolve(path, 'node_modules', dep);
                LOG.debug(method, 'Checking dependency path', dependencyPath);
                if (!fs.existsSync(dependencyPath)) {
                    // need to check to see if this is in a peer directory as well
                    //
                    LOG.debug(method,'trying different path '+path.replace(packageName,''));
                    dependencyPath = fsPath.resolve(path.replace(packageName,''),dep);
                    if(!fs.existsSync(dependencyPath)){
                        throw new Error('npm dependency path ' + dependencyPath + ' does not exist. Did you run npm install?');
                    }
                }

                BusinessNetworkDefinition.processDirectory(dependencyPath, {
                    accepts: function(file) {
                        return minimatch(file, options.modelFileGlob);
                    },
                    acceptsDir: function(dir) {
                        return true;
                    },
                    process: function(path,contents) {
                        modelFiles.push(contents);
                        LOG.debug(method, 'Found model file', path);
                    }
                });
            }
        }

        // define a help function that will filter out files
        // that are inside a node_modules directory under the path
        // we are processing
        const isFileInNodeModuleDir = function(file) {
            const method = 'isFileInNodeModuleDir';
            let filePath = fsPath.parse(file);
            let subPath = filePath.dir.substring(path.length);
            let result = subPath.split(fsPath.sep).some((element) => {
                return element === 'node_modules';
            });

            LOG.debug(method, file, result);
            return result;
        };

        // find CTO files outside the npm install directory
        //
        BusinessNetworkDefinition.processDirectory(path, {
            accepts: function(file) {
                return isFileInNodeModuleDir(file) === false &amp;&amp; minimatch(file, options.modelFileGlob);
            },
            acceptsDir: function(dir) {
                return !isFileInNodeModuleDir(dir);
            },
            process: function(path,contents) {
                modelFiles.push(contents);
                LOG.debug(method, 'Found model file', path);
            }
        });

        businessNetwork.getModelManager().addModelFiles(modelFiles);
        LOG.debug(method, 'Added model files',  modelFiles.length);

        // find script files outside the npm install directory
        const scriptFiles = [];
        BusinessNetworkDefinition.processDirectory(path, {
            accepts: function(file) {
                return isFileInNodeModuleDir(file) === false &amp;&amp; minimatch(file, options.scriptGlob);
            },
            acceptsDir: function(dir) {
                return !isFileInNodeModuleDir(dir);
            },
            process: function(path,contents) {
                let filePath = fsPath.parse(path);
                const jsScript = businessNetwork.getScriptManager().createScript(path, filePath.ext.toLowerCase(), contents);
                scriptFiles.push(jsScript);
                LOG.debug(method, 'Found script file ', path);
            }
        });

        if(modelFiles.length === 0) {
            throw new Error('Failed to find a model file.');
        }

        for( let script of scriptFiles) {
            businessNetwork.getScriptManager().addScript(script);
        }

        LOG.debug(method, 'Added script files', scriptFiles.length);

        // grab the permissions.acl
        const aclPath = fsPath.resolve(path, 'permissions.acl');
        if(fs.existsSync(aclPath)) {
            let permissionsAclContents = fs.readFileSync( aclPath, ENCODING);

            if(permissionsAclContents) {
                LOG.debug(method, 'Loaded permissions.acl', permissionsAclContents);
                const aclFile = new AclFile('permissions.acl', businessNetwork.getModelManager(), permissionsAclContents);
                businessNetwork.getAclManager().setAclFile(aclFile);
            }
        }

        LOG.exit(method, path);
        return Promise.resolve(businessNetwork);
    }

    /**
     * @param {String} path - the path to process
     * @param {Object} fileProcessor - the file processor. It must have
     * accept and process methods.
     * @private
     */
    static processDirectory(path, fileProcessor) {
        const items = BusinessNetworkDefinition.walkSync(path, [], fileProcessor);
        items.sort();
        LOG.debug('processDirectory', 'Path ' + path, items);
        items.forEach((item) => {
            BusinessNetworkDefinition.processFile(item, fileProcessor);
        });
    }

    /**
     * @param {String} file - the file to process
     * @param {Object} fileProcessor - the file processor. It must have
     * accepts and process methods.
     * @private
     */
    static processFile(file, fileProcessor) {

        if (fileProcessor.accepts(file)) {
            LOG.debug('processFile', 'FileProcessor accepted', file );
            let fileContents = fs.readFileSync(file, ENCODING);
            fileProcessor.process(file, fileContents);
        }
        else {
            LOG.debug('processFile', 'FileProcessor rejected', file );
        }
    }


    /**
     * @param {String} dir - the dir to walk
     * @param {Object[]} filelist - input files
     * @param {Object} fileProcessor - the file processor. It must have
     * accepts and process methods.
     * @return {Object[]} filelist - output files
     * @private
     */
    static walkSync(dir, filelist, fileProcessor) {
        let files = fs.readdirSync(dir);
        files.forEach(function (file) {
            let nestedPath = fsPath.join(dir, file);
            if (fs.lstatSync(nestedPath).isDirectory()) {
                if (fileProcessor.acceptsDir(nestedPath)) {
                    filelist = BusinessNetworkDefinition.walkSync(nestedPath, filelist, fileProcessor);
                }
            } else {
                filelist.push(nestedPath);
            }
        });
        return filelist;
    }


    /**
     * Visitor design pattern
     * @param {Object} visitor - the visitor
     * @param {Object} parameters  - the parameter
     * @return {Object} the result of visiting or null
     * @private
     */
    accept(visitor, parameters) {
        return visitor.visit(this, parameters);
    }

    /**
     * Provides access to the Introspector for this business network. The Introspector
     * is used to reflect on the types defined within this business network.
     * @return {Introspector} the Introspector for this business network
     */
    getIntrospector() {
        return this.introspector;
    }

    /**
     * Provides access to the Factory for this business network. The Factory
     * is used to create the types defined in this business network.
     * @return {Factory} the Factory for this business network
     */
    getFactory() {
        return this.factory;
    }

    /**
     * Provides access to the Serializer for this business network. The Serializer
     * is used to serialize instances of the types defined within this business network.
     * @return {Serializer} the Serializer for this business network
     */
    getSerializer() {
        return this.serializer;
    }

    /**
     * Provides access to the ScriptManager for this business network. The ScriptManager
     * manage access to the scripts that have been defined within this business network.
     * @return {ScriptManager} the ScriptManager for this business network
     * @private
     */
    getScriptManager() {
        return this.scriptManager;
    }

    /**
     * Provides access to the AclManager for this business network. The AclManager
     * manage access to the access conrol rules that have been defined for this business network.
     * @return {AclManager} the AclManager for this business network
     * @private
     */
    getAclManager() {
        return this.aclManager;
    }

    /**
     * Provides access to the ModelManager for this business network. The ModelManager
     * manage access to the models that have been defined within this business network.
     * @return {ModelManager} the ModelManager for this business network
     * @private
     */
    getModelManager() {
        return this.modelManager;
    }
}

module.exports = BusinessNetworkDefinition;
</pre>
    </article>
</section>





		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>

	 


	<span class="copyright">
	2017 Copyright IBM Corp. All Rights Reserved
	</span>

<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a>
	
		on Mon Jan 23rd 2017
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : true,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>
